<!DOCTYPE html>
<html>
  <head>
    <meta charset = "utf-8">
    <!-- Script for websocket communication, using the socket.io library to request a certain file-->
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.5.1/socket.io.min.js">
    </script>
    <!-- second script to initialize websocket connection between client and server-->
    <script>
      //Important code to setup a socket connection for whoever accesses the client web page
      var socket = io();

      //variable function to be used to send message to the server from clicking the button (Passes button id as paraemeter)
      var userClicked = function(buttonId){
        socket.emit('joining', {
          reason: buttonId
        });
      };

      //Listen for server message of user clicking a button and update it as locked
      //Ask server if user has already locked in at another seat
      socket.on('userPlaying',function(buttonId){
        document.getElementById(buttonId).innerText = "Locked";
      });

      //Will constantly run for 30fps to check if both buttons are locked
      setInterval(function(){
        var firstButton = document.getElementById("firstButton");
        var secondButton = document.getElementById("secondButton");
        //Update the 'waiting...'' text to 'ready'
        if(firstButton.innerText == secondButton.innerText && firstButton.innerText == "Locked")
        {
          document.getElementById("loadingText").innerText = "Ready";
          clearInterval();
        }
      }, 1000/30);

      /*#################
      ##   GAME CHAT   ##
      #################*/

      //Listen for server messages to update the chat for the client
      socket.on('addToChat', function(data){
        var chatText = document.getElementById('chat-text');
        chatText.innerHTML += "<div>" + data + "</div>";
      });

      //Called when the form is submitted, sends a message to the server to add any messages the user has into the chat box
      function userSubmission()
      {
        var chatInput = document.getElementById("chat-input").value;
        socket.emit('sendMsgToServer', chatInput);
        //Prevent user from refreshing the page (disconnecting) when pressing enter to submit chat
        return false;
      }

    </script>
  </head>

  <body>
    <!-- Testing div block for basic_server_logic -->
    <div>
      <strong id = "loadingText"> Waiting... </strong>
      <br>
      <button onclick = "userClicked(this.id)" id = "firstButton"> Join </button>
      <button onclick = "userClicked(this.id)" id = "secondButton"> Join </button>
    </div>
    <br>

    <!-- Game chat html tags -->
    <div id = "chat-text" style = "width: 500px; height: 100px; overflow-y:scroll">
      <div>Welcome!</div>
    </div>

    <form onsubmit = "return userSubmission();">
      <input id = "chat-input" type = "text" style = "width: 500px;"></input>
    </form>

  </body>
</html>
